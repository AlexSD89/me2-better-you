# 07_å¼€å‘æŒ‡å—.md

> **zhilink-v3 å¼€å‘æŒ‡å—**  
> **å®Œæ•´çš„å¼€å‘ç¯å¢ƒé…ç½®ä¸æœ€ä½³å®è·µ**  
> **ä»ç¯å¢ƒæ­å»ºåˆ°ç”Ÿäº§éƒ¨ç½²çš„å…¨æµç¨‹æŒ‡å¯¼**

---

## ğŸ¯ å¼€å‘ç¯å¢ƒæ­å»º

### ğŸ“‹ ç¯å¢ƒè¦æ±‚

```bash
# å¿…éœ€ç¯å¢ƒ
Node.js â‰¥ 18.17.0
npm â‰¥ 9.6.7 (æˆ– pnpm â‰¥ 8.6.0 æ¨è)
Git â‰¥ 2.40.0

# æ¨èå·¥å…·
Visual Studio Code â‰¥ 1.80.0
Chrome DevTools
React Developer Tools
```

### âš¡ å¿«é€Ÿå¼€å§‹

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/launchx/zhilink-v3.git
cd zhilink-v3

# 2. å®‰è£…ä¾èµ– (æ¨èä½¿ç”¨ pnpm)
pnpm install

# 3. ç¯å¢ƒå˜é‡é…ç½®
cp .env.example .env.local

# 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev

# 5. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
open http://localhost:3000
```

### ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

```bash
# .env.local é…ç½®ç¤ºä¾‹

# åº”ç”¨åŸºç¡€é…ç½®
NEXT_PUBLIC_APP_NAME="zhilink-v3"
NEXT_PUBLIC_APP_VERSION="3.0.0"
NEXT_PUBLIC_API_URL="https://api.zhilink.com"
NEXT_PUBLIC_WS_URL="wss://ws.zhilink.com"

# è®¤è¯é…ç½®
NEXT_PUBLIC_SUPABASE_URL="your-supabase-url"
NEXT_PUBLIC_SUPABASE_ANON_KEY="your-supabase-anon-key"
SUPABASE_SERVICE_ROLE_KEY="your-service-role-key"

# AIæœåŠ¡é…ç½®
OPENAI_API_KEY="sk-your-openai-key"
ANTHROPIC_API_KEY="your-anthropic-key"
NEXT_PUBLIC_AI_PROVIDER="openai"

# å­˜å‚¨é…ç½®
DATABASE_URL="postgresql://user:password@localhost:5432/zhilink"
REDIS_URL="redis://localhost:6379"
NEXT_PUBLIC_UPLOAD_URL="https://cdn.zhilink.com"

# ç›‘æ§å’Œåˆ†æ
NEXT_PUBLIC_ANALYTICS_ID="your-analytics-id"
SENTRY_DSN="your-sentry-dsn"
VERCEL_ANALYTICS_ID="your-vercel-analytics-id"

# æ”¯ä»˜é…ç½®
STRIPE_PUBLISHABLE_KEY="pk_your_stripe_key"
STRIPE_SECRET_KEY="sk_your_stripe_key"
STRIPE_WEBHOOK_SECRET="whsec_your_webhook_secret"

# é‚®ä»¶æœåŠ¡
EMAIL_SERVER_HOST="smtp.resend.com"
EMAIL_SERVER_PORT="587"
EMAIL_SERVER_USER="your-email-user"
EMAIL_SERVER_PASSWORD="your-email-password"
EMAIL_FROM="noreply@zhilink.com"
```

---

## ğŸ“ é¡¹ç›®ç»“æ„è¯¦è§£

### ğŸ—ï¸ ç›®å½•æ¶æ„

```
zhilink-v3/
â”œâ”€â”€ ğŸ“ .next/                    # Next.js æ„å»ºè¾“å‡º
â”œâ”€â”€ ğŸ“ .vscode/                  # VS Code é…ç½®
â”œâ”€â”€ ğŸ“ docs/                     # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ ğŸ“„ 01_é¡¹ç›®æ¶æ„è®¾è®¡.md
â”‚   â”œâ”€â”€ ğŸ“„ 02_è§†è§‰è®¾è®¡ç³»ç»Ÿ.md
â”‚   â”œâ”€â”€ ğŸ“„ 03_é¡µé¢å¸ƒå±€æ–¹æ¡ˆ.md
â”‚   â”œâ”€â”€ ğŸ“„ 04_äº¤äº’åŠ¨æ•ˆè®¾è®¡.md
â”‚   â”œâ”€â”€ ğŸ“„ 05_ç»„ä»¶åº“è§„èŒƒ.md
â”‚   â”œâ”€â”€ ğŸ“„ 06_æ•°æ®äº¤äº’è®¾è®¡.md
â”‚   â””â”€â”€ ğŸ“„ 07_å¼€å‘æŒ‡å—.md
â”œâ”€â”€ ğŸ“ public/                   # é™æ€èµ„æº
â”‚   â”œâ”€â”€ ğŸ“ images/
â”‚   â”œâ”€â”€ ğŸ“ icons/
â”‚   â””â”€â”€ ğŸ“ fonts/
â”œâ”€â”€ ğŸ“ src/                      # æºä»£ç 
â”‚   â”œâ”€â”€ ğŸ“ app/                  # Next.js 14 App Router
â”‚   â”‚   â”œâ”€â”€ ğŸ“ (auth)/           # è®¤è¯è·¯ç”±ç»„
â”‚   â”‚   â”œâ”€â”€ ğŸ“ (dashboard)/      # ä»ªè¡¨æ¿è·¯ç”±ç»„
â”‚   â”‚   â”œâ”€â”€ ğŸ“ api/              # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ globals.css       # å…¨å±€æ ·å¼
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ layout.tsx        # æ ¹å¸ƒå±€
â”‚   â”‚   â””â”€â”€ ğŸ“„ page.tsx          # é¦–é¡µ
â”‚   â”œâ”€â”€ ğŸ“ components/           # ç»„ä»¶åº“
â”‚   â”‚   â”œâ”€â”€ ğŸ“ ui/               # åŸºç¡€UIç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“ business/         # ä¸šåŠ¡ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“ layout/           # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ğŸ“ forms/            # è¡¨å•ç»„ä»¶
â”‚   â”œâ”€â”€ ğŸ“ hooks/                # è‡ªå®šä¹‰Hooks
â”‚   â”œâ”€â”€ ğŸ“ lib/                  # å·¥å…·åº“
â”‚   â”‚   â”œâ”€â”€ ğŸ“ api/              # APIå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ ğŸ“ auth/             # è®¤è¯é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ ğŸ“ database/         # æ•°æ®åº“æ“ä½œ
â”‚   â”‚   â””â”€â”€ ğŸ“ utils/            # é€šç”¨å·¥å…·
â”‚   â”œâ”€â”€ ğŸ“ stores/               # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ ğŸ“ styles/               # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ ğŸ“ types/                # TypeScriptç±»å‹å®šä¹‰
â”œâ”€â”€ ğŸ“ tests/                    # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ .env.example              # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ ğŸ“„ .eslintrc.json            # ESLinté…ç½®
â”œâ”€â”€ ğŸ“„ .gitignore               # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ next.config.js           # Next.jsé…ç½®
â”œâ”€â”€ ğŸ“„ package.json             # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ ğŸ“„ tailwind.config.js       # Tailwindé…ç½®
â”œâ”€â”€ ğŸ“„ tsconfig.json            # TypeScripté…ç½®
â””â”€â”€ ğŸ“„ README.md                # é¡¹ç›®è¯´æ˜
```

### ğŸ“ å…³é”®æ–‡ä»¶è¯´æ˜

#### Next.js é…ç½®
```javascript
// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    serverActions: true,
    typedRoutes: true,
  },
  
  images: {
    domains: ['cdn.zhilink.com', 'via.placeholder.com'],
    formats: ['image/webp', 'image/avif'],
  },
  
  env: {
    CUSTOM_KEY: process.env.CUSTOM_KEY,
  },
  
  async rewrites() {
    return [
      {
        source: '/api/v1/:path*',
        destination: `${process.env.API_URL}/api/v1/:path*`,
      },
    ];
  },
  
  async headers() {
    return [
      {
        source: '/(.*)',
        headers: [
          {
            key: 'X-Frame-Options',
            value: 'DENY',
          },
          {
            key: 'X-Content-Type-Options',
            value: 'nosniff',
          },
        ],
      },
    ];
  },
  
  webpack: (config, { buildId, dev, isServer, defaultLoaders, nextRuntime, webpack }) => {
    // è‡ªå®šä¹‰ webpack é…ç½®
    if (!isServer) {
      config.resolve.fallback = {
        ...config.resolve.fallback,
        fs: false,
        net: false,
        tls: false,
      };
    }
    
    return config;
  },
};

module.exports = nextConfig;
```

#### TypeScript é…ç½®
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["dom", "dom.iterable", "es6"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"],
      "@/components/*": ["./src/components/*"],
      "@/hooks/*": ["./src/hooks/*"],
      "@/lib/*": ["./src/lib/*"],
      "@/styles/*": ["./src/styles/*"],
      "@/types/*": ["./src/types/*"],
      "@/stores/*": ["./src/stores/*"],
      "@/utils/*": ["./src/lib/utils/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts"
  ],
  "exclude": ["node_modules"]
}
```

---

## ğŸ’» å¼€å‘å·¥ä½œæµ

### ğŸ”„ Git å·¥ä½œæµ

```bash
# 1. åŠŸèƒ½å¼€å‘æµç¨‹
git checkout -b feature/user-authentication
git add .
git commit -m "feat(auth): implement user authentication system"
git push origin feature/user-authentication

# 2. æäº¤ä¿¡æ¯è§„èŒƒ (Conventional Commits)
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤bug
docs: æ–‡æ¡£æ›´æ–°
style: æ ·å¼ä¿®æ”¹
refactor: ä»£ç é‡æ„
test: æµ‹è¯•ç›¸å…³
chore: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

# 3. åˆ†æ”¯ç®¡ç†
main        # ä¸»åˆ†æ”¯ï¼Œç”¨äºç”Ÿäº§éƒ¨ç½²
develop     # å¼€å‘åˆ†æ”¯ï¼Œç”¨äºåŠŸèƒ½é›†æˆ
feature/*   # åŠŸèƒ½åˆ†æ”¯
hotfix/*    # ç´§æ€¥ä¿®å¤åˆ†æ”¯
release/*   # å‘å¸ƒåˆ†æ”¯
```

### âš¡ å¼€å‘å‘½ä»¤è¯¦è§£

```bash
# å¼€å‘ç›¸å…³å‘½ä»¤
pnpm dev              # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ (localhost:3000)
pnpm dev:turbo        # ä½¿ç”¨ Turbopack å¯åŠ¨ (æ›´å¿«)
pnpm build            # ç”Ÿäº§ç¯å¢ƒæ„å»º
pnpm start            # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
pnpm preview          # é¢„è§ˆç”Ÿäº§æ„å»º

# ä»£ç è´¨é‡æ£€æŸ¥
pnpm lint             # ESLint æ£€æŸ¥
pnpm lint:fix         # è‡ªåŠ¨ä¿®å¤ ESLint é—®é¢˜
pnpm typecheck        # TypeScript ç±»å‹æ£€æŸ¥
pnpm format:check     # Prettier æ ¼å¼æ£€æŸ¥
pnpm format:write     # Prettier æ ¼å¼åŒ–ä»£ç 

# æµ‹è¯•ç›¸å…³å‘½ä»¤
pnpm test             # è¿è¡Œå•å…ƒæµ‹è¯•
pnpm test:watch       # ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
pnpm test:coverage    # ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
pnpm test:e2e         # è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•

# æ•°æ®åº“æ“ä½œ
pnpm db:generate      # ç”Ÿæˆ Prisma å®¢æˆ·ç«¯
pnpm db:push          # æ¨é€ schema åˆ°æ•°æ®åº“
pnpm db:migrate       # è¿è¡Œæ•°æ®åº“è¿ç§»
pnpm db:studio        # æ‰“å¼€ Prisma Studio
pnpm db:seed          # å¡«å……ç§å­æ•°æ®

# ç»„ä»¶å¼€å‘
pnpm storybook        # å¯åŠ¨ Storybook
pnpm build-storybook  # æ„å»º Storybook

# åˆ†æå’Œè°ƒè¯•
pnpm analyze          # åˆ†ææ„å»ºåŒ…å¤§å°
pnpm bundle-analyzer  # å¯è§†åŒ–åŒ…åˆ†æ
pnpm lighthouse       # è¿è¡Œ Lighthouse åˆ†æ
```

### ğŸ§ª æµ‹è¯•ç­–ç•¥

```typescript
// æµ‹è¯•é…ç½® - jest.config.js
const config = {
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],
  testPathIgnorePatterns: ['<rootDir>/.next/', '<rootDir>/node_modules/'],
  transform: {
    '^.+\\.(js|jsx|ts|tsx)$': ['babel-jest', { presets: ['next/babel'] }],
  },
  moduleNameMapping: {
    '^@/(.*)$': '<rootDir>/src/$1',
  },
  collectCoverageFrom: [
    'src/**/*.{js,jsx,ts,tsx}',
    '!src/**/*.d.ts',
    '!src/**/*.stories.{js,jsx,ts,tsx}',
  ],
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80,
    },
  },
};

module.exports = config;
```

### ğŸ“ ä»£ç è§„èŒƒ

#### ESLint é…ç½®
```json
{
  "extends": [
    "next/core-web-vitals",
    "@typescript-eslint/recommended",
    "prettier"
  ],
  "rules": {
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/no-explicit-any": "warn",
    "react-hooks/exhaustive-deps": "warn",
    "prefer-const": "error",
    "no-var": "error"
  },
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "ecmaVersion": 2020,
    "sourceType": "module",
    "ecmaFeatures": {
      "jsx": true
    }
  }
}
```

#### Prettier é…ç½®
```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false,
  "bracketSpacing": true,
  "bracketSameLine": false,
  "arrowParens": "avoid"
}
```

---

## ğŸ§© ç»„ä»¶å¼€å‘æŒ‡å—

### ğŸ“ ç»„ä»¶ç¼–å†™è§„èŒƒ

```typescript
// ç»„ä»¶æ¨¡æ¿ç¤ºä¾‹
// src/components/ui/example-component.tsx

import React from 'react';
import { cn } from '@/lib/utils';
import { cva, type VariantProps } from 'class-variance-authority';

// 1. æ ·å¼å˜ä½“å®šä¹‰
const exampleVariants = cva(
  'base-styles-here',
  {
    variants: {
      variant: {
        default: 'default-styles',
        secondary: 'secondary-styles',
      },
      size: {
        sm: 'small-styles',
        md: 'medium-styles',
        lg: 'large-styles',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'md',
    },
  }
);

// 2. ç»„ä»¶Propsæ¥å£
interface ExampleComponentProps 
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof exampleVariants> {
  children: React.ReactNode;
  disabled?: boolean;
  loading?: boolean;
}

// 3. ç»„ä»¶å®ç°
const ExampleComponent = React.forwardRef<HTMLDivElement, ExampleComponentProps>(
  ({ className, variant, size, children, disabled, loading, ...props }, ref) => {
    return (
      <div
        ref={ref}
        className={cn(exampleVariants({ variant, size }), className)}
        aria-disabled={disabled}
        {...props}
      >
        {loading ? <LoadingSpinner /> : children}
      </div>
    );
  }
);

ExampleComponent.displayName = 'ExampleComponent';

export { ExampleComponent, exampleVariants };
export type { ExampleComponentProps };
```

### ğŸ¨ æ ·å¼ç¼–å†™è§„èŒƒ

```css
/* Tailwind CSS è‡ªå®šä¹‰æ ·å¼ */
/* src/styles/components.css */

@layer components {
  /* åŸºç¡€ç»„ä»¶æ ·å¼ */
  .btn-base {
    @apply inline-flex items-center justify-center;
    @apply rounded-lg font-medium transition-colors;
    @apply focus-visible:outline-none focus-visible:ring-2;
    @apply disabled:pointer-events-none disabled:opacity-50;
  }
  
  /* Cloudsway è®¾è®¡ç³»ç»Ÿæ ·å¼ */
  .card-cloudsway {
    @apply bg-cloudsway-glass-bg backdrop-blur-xl;
    @apply border border-cloudsway-glass-border;
    @apply rounded-xl shadow-lg;
  }
  
  /* 6è§’è‰²é¢œè‰²æ ·å¼ */
  .agent-alex { @apply text-[#3b82f6] bg-[#3b82f6]/10; }
  .agent-sarah { @apply text-[#8b5cf6] bg-[#8b5cf6]/10; }
  .agent-mike { @apply text-[#10b981] bg-[#10b981]/10; }
  .agent-emma { @apply text-[#f59e0b] bg-[#f59e0b]/10; }
  .agent-david { @apply text-[#6366f1] bg-[#6366f1]/10; }
  .agent-catherine { @apply text-[#ec4899] bg-[#ec4899]/10; }
}

@layer utilities {
  /* å®ç”¨å·¥å…·ç±» */
  .text-gradient-primary {
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
}
```

### ğŸ”§ Hooks å¼€å‘è§„èŒƒ

```typescript
// è‡ªå®šä¹‰Hookç¤ºä¾‹
// src/hooks/use-example.ts

import { useState, useEffect, useCallback } from 'react';

interface UseExampleOptions {
  initialValue?: string;
  debounceMs?: number;
}

interface UseExampleReturn {
  value: string;
  setValue: (value: string) => void;
  debouncedValue: string;
  isLoading: boolean;
  error: Error | null;
}

export function useExample(options: UseExampleOptions = {}): UseExampleReturn {
  const { initialValue = '', debounceMs = 300 } = options;
  
  const [value, setValue] = useState(initialValue);
  const [debouncedValue, setDebouncedValue] = useState(initialValue);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<Error | null>(null);
  
  // é˜²æŠ–å¤„ç†
  useEffect(() => {
    const timer = setTimeout(() => {
      setDebouncedValue(value);
    }, debounceMs);
    
    return () => clearTimeout(timer);
  }, [value, debounceMs]);
  
  // ä¸šåŠ¡é€»è¾‘å¤„ç†
  const handleSetValue = useCallback((newValue: string) => {
    try {
      setIsLoading(true);
      setError(null);
      setValue(newValue);
      
      // æ‰§è¡Œå‰¯ä½œç”¨
      // ...
      
    } catch (err) {
      setError(err as Error);
    } finally {
      setIsLoading(false);
    }
  }, []);
  
  return {
    value,
    setValue: handleSetValue,
    debouncedValue,
    isLoading,
    error,
  };
}
```

---

## ğŸ—„ï¸ æ•°æ®åº“å¼€å‘

### ğŸ“Š Prisma Schema è®¾è®¡

```prisma
// schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ç”¨æˆ·è¡¨
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  avatar    String?
  role      UserRole @default(BUYER)
  
  // å…¬å¸ä¿¡æ¯
  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?
  
  // åå¥½è®¾ç½®
  preferences Json?
  
  // è®¢é˜…ä¿¡æ¯
  subscription UserSubscription?
  
  // å…³è”å…³ç³»
  sessions     AnalysisSession[]
  orders       Order[]
  reviews      Review[]
  favorites    UserFavorite[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("users")
}

// äº§å“è¡¨
model Product {
  id          String        @id @default(cuid())
  name        String
  slug        String        @unique
  description String
  type        ProductType
  status      ProductStatus @default(DRAFT)
  
  // ä¾›åº”å•†ä¿¡æ¯
  vendor   Vendor @relation(fields: [vendorId], references: [id])
  vendorId String
  
  // äº§å“ä¿¡æ¯
  category String
  tags     String[]
  industry Industry[]
  
  // åª’ä½“èµ„æº
  images      String[]
  videos      String[]
  documents   Json?
  
  // å®šä»·ä¿¡æ¯
  pricing Json
  
  // æŠ€æœ¯æŒ‡æ ‡
  metrics Json?
  
  // è¯„ä»·ç»Ÿè®¡
  rating      Float   @default(0)
  ratingCount Int     @default(0)
  
  // å…³è”å…³ç³»
  reviews     Review[]
  favorites   UserFavorite[]
  orderItems  OrderItem[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  publishedAt DateTime?
  
  @@map("products")
}

// åˆ†æä¼šè¯è¡¨
model AnalysisSession {
  id     String            @id @default(cuid())
  title  String
  status AnalysisStatus    @default(INITIALIZING)
  
  // ç”¨æˆ·ä¿¡æ¯
  user   User   @relation(fields: [userId], references: [id])
  userId String
  
  // ä¼šè¯å†…å®¹
  input     Json  // ç”¨æˆ·è¾“å…¥
  analysis  Json? // 6è§’è‰²åˆ†æç»“æœ
  synthesis Json? // ç»¼åˆç»“æœ
  
  // æ¶ˆæ¯è®°å½•
  messages ChatMessage[]
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  completedAt DateTime?
  
  @@map("analysis_sessions")
}

// æšä¸¾å®šä¹‰
enum UserRole {
  BUYER
  VENDOR
  DISTRIBUTOR
}

enum ProductType {
  WORKFORCE
  EXPERT_MODULE
  MARKET_REPORT
}

enum ProductStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum Industry {
  LEGAL
  MEDICAL
  ECOMMERCE
}

enum AnalysisStatus {
  INITIALIZING
  ANALYZING
  COMPLETED
  FAILED
}
```

### ğŸ”§ æ•°æ®åº“æ“ä½œç¤ºä¾‹

```typescript
// src/lib/database/products.ts
import { prisma } from '@/lib/database/client';
import { Product, ProductFilters } from '@/types';

export class ProductRepository {
  // è·å–äº§å“åˆ—è¡¨
  async findMany(filters: ProductFilters, page = 1, limit = 20) {
    const skip = (page - 1) * limit;
    
    const where = {
      status: 'PUBLISHED',
      ...(filters.type && { type: { in: filters.type } }),
      ...(filters.category && { category: { in: filters.category } }),
      ...(filters.industry && { industry: { hasMany: filters.industry } }),
      ...(filters.search && {
        OR: [
          { name: { contains: filters.search, mode: 'insensitive' } },
          { description: { contains: filters.search, mode: 'insensitive' } },
          { tags: { has: filters.search } },
        ],
      }),
    };
    
    const [products, total] = await Promise.all([
      prisma.product.findMany({
        where,
        include: {
          vendor: true,
          _count: {
            select: {
              reviews: true,
              favorites: true,
            },
          },
        },
        skip,
        take: limit,
        orderBy: this.buildOrderBy(filters.sort, filters.order),
      }),
      prisma.product.count({ where }),
    ]);
    
    return {
      items: products,
      pagination: {
        page,
        pageSize: limit,
        total,
        totalPages: Math.ceil(total / limit),
        hasNext: page * limit < total,
        hasPrevious: page > 1,
      },
    };
  }
  
  // è·å–äº§å“è¯¦æƒ…
  async findById(id: string) {
    return prisma.product.findUnique({
      where: { id },
      include: {
        vendor: true,
        reviews: {
          include: {
            user: {
              select: { name: true, avatar: true },
            },
          },
          orderBy: { createdAt: 'desc' },
          take: 10,
        },
        _count: {
          select: {
            reviews: true,
            favorites: true,
          },
        },
      },
    });
  }
  
  // æœç´¢äº§å“
  async search(query: string, filters: ProductFilters) {
    return prisma.product.findMany({
      where: {
        status: 'PUBLISHED',
        OR: [
          { name: { contains: query, mode: 'insensitive' } },
          { description: { contains: query, mode: 'insensitive' } },
          { tags: { has: query } },
        ],
        ...(filters.type && { type: { in: filters.type } }),
        ...(filters.category && { category: { in: filters.category } }),
      },
      include: {
        vendor: true,
        _count: {
          select: { reviews: true, favorites: true },
        },
      },
      take: 50,
    });
  }
  
  private buildOrderBy(sort?: string, order?: 'asc' | 'desc') {
    const direction = order || 'desc';
    
    switch (sort) {
      case 'name':
        return { name: direction };
      case 'rating':
        return { rating: direction };
      case 'popularity':
        return { ratingCount: direction };
      case 'newest':
        return { createdAt: direction };
      default:
        return { createdAt: 'desc' };
    }
  }
}

export const productRepository = new ProductRepository();
```

---

## ğŸš€ éƒ¨ç½²æŒ‡å—

### ğŸŒ Vercel éƒ¨ç½² (æ¨è)

```bash
# 1. å®‰è£… Vercel CLI
npm i -g vercel

# 2. ç™»å½• Vercel
vercel login

# 3. é¡¹ç›®åˆå§‹åŒ–
vercel

# 4. ç¯å¢ƒå˜é‡é…ç½®
vercel env add NEXT_PUBLIC_API_URL
vercel env add DATABASE_URL
vercel env add OPENAI_API_KEY

# 5. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
vercel --prod
```

### ğŸ³ Docker éƒ¨ç½²

```dockerfile
# Dockerfile
FROM node:18-alpine AS base

# å®‰è£…ä¾èµ–
FROM base AS deps
RUN apk add --no-cache libc6-compat
WORKDIR /app

COPY package.json pnpm-lock.yaml* ./
RUN corepack enable pnpm && pnpm i --frozen-lockfile

# æ„å»ºåº”ç”¨
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

ENV NEXT_TELEMETRY_DISABLED 1
RUN corepack enable pnpm && pnpm build

# ç”Ÿäº§é•œåƒ
FROM base AS runner
WORKDIR /app

ENV NODE_ENV production
ENV NEXT_TELEMETRY_DISABLED 1

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000
ENV PORT 3000

CMD ["node", "server.js"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://postgres:password@db:5432/zhilink
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis
    
  db:
    image: postgres:15
    environment:
      POSTGRES_DB: zhilink
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

### â˜ï¸ AWS éƒ¨ç½²

```bash
# ä½¿ç”¨ AWS CDK éƒ¨ç½²
npm install -g aws-cdk

# åˆå§‹åŒ– CDK é¡¹ç›®
cdk init app --language typescript

# éƒ¨ç½²åˆ° AWS
cdk deploy
```

---

## ğŸ” è°ƒè¯•ä¸ç›‘æ§

### ğŸ› è°ƒè¯•å·¥å…·é…ç½®

```json
// .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Next.js: debug server-side",
      "type": "node",
      "request": "attach",
      "port": 9229,
      "skipFiles": ["<node_internals>/**"]
    },
    {
      "name": "Next.js: debug client-side",
      "type": "chrome",
      "request": "launch",
      "url": "http://localhost:3000"
    },
    {
      "name": "Next.js: debug full stack",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/node_modules/.bin/next",
      "args": ["dev"],
      "console": "integratedTerminal",
      "skipFiles": ["<node_internals>/**"]
    }
  ]
}
```

### ğŸ“Š æ€§èƒ½ç›‘æ§

```typescript
// src/lib/monitoring/performance.ts
import { NextWebVitalsMetric } from 'next/app';

export function reportWebVitals(metric: NextWebVitalsMetric) {
  const { id, name, label, value } = metric;
  
  // å‘é€åˆ°åˆ†ææœåŠ¡
  if (process.env.NODE_ENV === 'production') {
    // Google Analytics
    window.gtag?.('event', name, {
      event_category: label === 'web-vital' ? 'Web Vitals' : 'Next.js custom metric',
      value: Math.round(name === 'CLS' ? value * 1000 : value),
      event_label: id,
      non_interaction: true,
    });
    
    // Vercel Analytics
    window.va?.track(name, { value, label });
    
    // è‡ªå®šä¹‰ç›‘æ§
    fetch('/api/analytics/web-vitals', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ metric }),
    });
  }
  
  // å¼€å‘ç¯å¢ƒæ—¥å¿—
  if (process.env.NODE_ENV === 'development') {
    console.log('Web Vital:', { name, value, label });
  }
}
```

### ğŸš¨ é”™è¯¯ç›‘æ§

```typescript
// src/lib/monitoring/error-boundary.tsx
import React from 'react';
import * as Sentry from '@sentry/nextjs';

interface ErrorBoundaryState {
  hasError: boolean;
  error?: Error;
}

export class ErrorBoundary extends React.Component<
  React.PropsWithChildren<{}>,
  ErrorBoundaryState
> {
  constructor(props: React.PropsWithChildren<{}>) {
    super(props);
    this.state = { hasError: false };
  }
  
  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    return { hasError: true, error };
  }
  
  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    // å‘é€é”™è¯¯åˆ° Sentry
    Sentry.captureException(error, {
      contexts: {
        react: {
          componentStack: errorInfo.componentStack,
        },
      },
    });
    
    // è‡ªå®šä¹‰é”™è¯¯æ—¥å¿—
    console.error('Error caught by boundary:', error, errorInfo);
  }
  
  render() {
    if (this.state.hasError) {
      return (
        <div className="min-h-screen flex items-center justify-center">
          <div className="text-center">
            <h2 className="text-2xl font-bold mb-4">å‡ºé”™äº†</h2>
            <p className="text-gray-600 mb-4">
              åº”ç”¨é‡åˆ°äº†ä¸€ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬å·²ç»è®°å½•äº†è¿™ä¸ªé—®é¢˜ã€‚
            </p>
            <button
              onClick={() => this.setState({ hasError: false })}
              className="btn-primary"
            >
              é‡è¯•
            </button>
          </div>
        </div>
      );
    }
    
    return this.props.children;
  }
}
```

---

## ğŸ“‹ å¼€å‘æ£€æŸ¥æ¸…å•

### ğŸ—ï¸ é¡¹ç›®åˆå§‹åŒ–
- [ ] ç¯å¢ƒå˜é‡é…ç½®å®Œæˆ
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] ä¾èµ–å®‰è£…æ— é”™è¯¯
- [ ] å¼€å‘æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ
- [ ] Git ä»“åº“åˆå§‹åŒ–

### ğŸ’» å¼€å‘ç¯å¢ƒé…ç½®
- [ ] VS Code æ’ä»¶å®‰è£…å®Œæˆ
- [ ] ESLint é…ç½®æ­£ç¡®
- [ ] Prettier æ ¼å¼åŒ–æ­£å¸¸
- [ ] TypeScript ç¼–è¯‘æ— é”™è¯¯
- [ ] è°ƒè¯•é…ç½®å¯ç”¨

### ğŸ§ª ä»£ç è´¨é‡æ£€æŸ¥
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- [ ] E2E æµ‹è¯•å…³é”®è·¯å¾„
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] å®‰å…¨æ£€æŸ¥é€šè¿‡
- [ ] ä»£ç å®¡æŸ¥å®Œæˆ

### ğŸš€ éƒ¨ç½²å‡†å¤‡
- [ ] ç”Ÿäº§ç¯å¢ƒå˜é‡é…ç½®
- [ ] æ„å»ºæµç¨‹æµ‹è¯•
- [ ] Docker é•œåƒæ„å»º
- [ ] ç›‘æ§å’Œæ—¥å¿—é…ç½®
- [ ] é”™è¯¯è¿½è¸ªè®¾ç½®

### ğŸ“Š æ€§èƒ½ä¼˜åŒ–
- [ ] Core Web Vitals è¾¾æ ‡
- [ ] åŒ…å¤§å°ä¼˜åŒ–
- [ ] å›¾ç‰‡ä¼˜åŒ–
- [ ] ç¼“å­˜ç­–ç•¥å®ç°
- [ ] CDN é…ç½®

---

## ğŸ†˜ å¸¸è§é—®é¢˜è§£å†³

### âŒ å¸¸è§é”™è¯¯

#### 1. æ¨¡å—è§£æé”™è¯¯
```bash
Error: Cannot resolve module '@/components/ui/button'

# è§£å†³æ–¹æ¡ˆï¼š
# æ£€æŸ¥ tsconfig.json ä¸­çš„ paths é…ç½®
# ç¡®ä¿ baseUrl è®¾ç½®æ­£ç¡®
```

#### 2. æ ·å¼ä¸ç”Ÿæ•ˆ
```bash
Tailwind CSS æ ·å¼æ²¡æœ‰åº”ç”¨

# è§£å†³æ–¹æ¡ˆï¼š
# æ£€æŸ¥ tailwind.config.js çš„ content é…ç½®
# ç¡®ä¿æ ·å¼æ–‡ä»¶æ­£ç¡®å¯¼å…¥
# æ¸…é™¤ .next ç¼“å­˜é‡æ–°æ„å»º
```

#### 3. API è¿æ¥å¤±è´¥
```bash
Network Error: Cannot connect to API

# è§£å†³æ–¹æ¡ˆï¼š
# æ£€æŸ¥ .env.local ä¸­çš„ API_URL é…ç½®
# ç¡®ä¿ API æœåŠ¡æ­£åœ¨è¿è¡Œ
# æ£€æŸ¥ CORS é…ç½®
```

### ğŸ”§ æ€§èƒ½è°ƒä¼˜

```typescript
// ç»„ä»¶æ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹
import { memo, useMemo, useCallback } from 'react';

const OptimizedComponent = memo(({ items, onItemClick }) => {
  // ä½¿ç”¨ useMemo ç¼“å­˜è®¡ç®—ç»“æœ
  const processedItems = useMemo(() => {
    return items.map(item => ({
      ...item,
      processed: true,
    }));
  }, [items]);
  
  // ä½¿ç”¨ useCallback ç¼“å­˜å‡½æ•°å¼•ç”¨
  const handleClick = useCallback((id: string) => {
    onItemClick(id);
  }, [onItemClick]);
  
  return (
    <div>
      {processedItems.map(item => (
        <div key={item.id} onClick={() => handleClick(item.id)}>
          {item.name}
        </div>
      ))}
    </div>
  );
});
```

### ğŸ” å®‰å…¨æœ€ä½³å®è·µ

```typescript
// è¾“å…¥éªŒè¯å’Œæ¸…ç†
import DOMPurify from 'dompurify';
import { z } from 'zod';

// ä½¿ç”¨ Zod è¿›è¡Œè¾“å…¥éªŒè¯
const userInputSchema = z.object({
  name: z.string().min(1).max(100),
  email: z.string().email(),
  content: z.string().max(1000),
});

// æ¸…ç† HTML å†…å®¹
const sanitizeHtml = (html: string) => {
  return DOMPurify.sanitize(html, {
    ALLOWED_TAGS: ['p', 'br', 'strong', 'em'],
    ALLOWED_ATTR: [],
  });
};

// API è·¯ç”±å®‰å…¨ç¤ºä¾‹
export async function POST(request: Request) {
  try {
    const body = await request.json();
    
    // éªŒè¯è¾“å…¥
    const validatedData = userInputSchema.parse(body);
    
    // æ¸…ç†å†…å®¹
    const cleanContent = sanitizeHtml(validatedData.content);
    
    // å¤„ç†ä¸šåŠ¡é€»è¾‘
    // ...
    
  } catch (error) {
    if (error instanceof z.ZodError) {
      return Response.json({ error: 'Invalid input' }, { status: 400 });
    }
    
    return Response.json({ error: 'Internal error' }, { status: 500 });
  }
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v3.0.0  
**æœ€åæ›´æ–°**: 2025å¹´8æœˆ13æ—¥  
**è´Ÿè´£å›¢é˜Ÿ**: LaunchXå‰ç«¯å¼€å‘å›¢é˜Ÿ