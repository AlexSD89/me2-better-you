# 开发指南与执行计划

## 开发指南部分
# 07_开发指南.md

> **zhilink-v3 开发指南**  
> **完整的开发环境配置与最佳实践**  
> **从环境搭建到生产部署的全流程指导**

---

## 🎯 开发环境搭建

### 📋 环境要求

```bash
# 必需环境
Node.js ≥ 18.17.0
npm ≥ 9.6.7 (或 pnpm ≥ 8.6.0 推荐)
Git ≥ 2.40.0

# 推荐工具
Visual Studio Code ≥ 1.80.0
Chrome DevTools
React Developer Tools
```

### ⚡ 快速开始

```bash
# 1. 克隆项目
git clone https://github.com/launchx/zhilink-v3.git
cd zhilink-v3

# 2. 安装依赖 (推荐使用 pnpm)
pnpm install

# 3. 环境变量配置
cp .env.example .env.local

# 4. 启动开发服务器
pnpm dev

# 5. 在浏览器中打开
open http://localhost:3000
```

### 🔧 环境变量配置

```bash
# .env.local 配置示例

# 应用基础配置
NEXT_PUBLIC_APP_NAME="zhilink-v3"
NEXT_PUBLIC_APP_VERSION="3.0.0"
NEXT_PUBLIC_API_URL="https://api.zhilink.com"
NEXT_PUBLIC_WS_URL="wss://ws.zhilink.com"

# 认证配置
NEXT_PUBLIC_SUPABASE_URL="your-supabase-url"
NEXT_PUBLIC_SUPABASE_ANON_KEY="your-supabase-anon-key"
SUPABASE_SERVICE_ROLE_KEY="your-service-role-key"

# AI服务配置
OPENAI_API_KEY="sk-your-openai-key"
ANTHROPIC_API_KEY="your-anthropic-key"
NEXT_PUBLIC_AI_PROVIDER="openai"

# 存储配置
DATABASE_URL="postgresql://user:password@localhost:5432/zhilink"
REDIS_URL="redis://localhost:6379"
NEXT_PUBLIC_UPLOAD_URL="https://cdn.zhilink.com"

# 监控和分析
NEXT_PUBLIC_ANALYTICS_ID="your-analytics-id"
SENTRY_DSN="your-sentry-dsn"
VERCEL_ANALYTICS_ID="your-vercel-analytics-id"

# 支付配置
STRIPE_PUBLISHABLE_KEY="pk_your_stripe_key"
STRIPE_SECRET_KEY="sk_your_stripe_key"
STRIPE_WEBHOOK_SECRET="whsec_your_webhook_secret"

# 邮件服务
EMAIL_SERVER_HOST="smtp.resend.com"
EMAIL_SERVER_PORT="587"
EMAIL_SERVER_USER="your-email-user"
EMAIL_SERVER_PASSWORD="your-email-password"
EMAIL_FROM="noreply@zhilink.com"
```

---

## 📁 项目结构详解

### 🏗️ 目录架构

```
zhilink-v3/
├── 📁 .next/                    # Next.js 构建输出
├── 📁 .vscode/                  # VS Code 配置
├── 📁 docs/                     # 项目文档
│   ├── 📄 01_项目架构设计.md
│   ├── 📄 02_视觉设计系统.md
│   ├── 📄 03_页面布局方案.md
│   ├── 📄 04_交互动效设计.md
│   ├── 📄 05_组件库规范.md
│   ├── 📄 06_数据交互设计.md
│   └── 📄 07_开发指南.md
├── 📁 public/                   # 静态资源
│   ├── 📁 images/
│   ├── 📁 icons/
│   └── 📁 fonts/
├── 📁 src/                      # 源代码
│   ├── 📁 app/                  # Next.js 14 App Router
│   │   ├── 📁 (auth)/           # 认证路由组
│   │   ├── 📁 (dashboard)/      # 仪表板路由组
│   │   ├── 📁 api/              # API 路由
│   │   ├── 📄 globals.css       # 全局样式
│   │   ├── 📄 layout.tsx        # 根布局
│   │   └── 📄 page.tsx          # 首页
│   ├── 📁 components/           # 组件库
│   │   ├── 📁 ui/               # 基础UI组件
│   │   ├── 📁 business/         # 业务组件
│   │   ├── 📁 layout/           # 布局组件
│   │   └── 📁 forms/            # 表单组件
│   ├── 📁 hooks/                # 自定义Hooks
│   ├── 📁 lib/                  # 工具库
│   │   ├── 📁 api/              # API客户端
│   │   ├── 📁 auth/             # 认证逻辑
│   │   ├── 📁 database/         # 数据库操作
│   │   └── 📁 utils/            # 通用工具
│   ├── 📁 stores/               # 状态管理
│   ├── 📁 styles/               # 样式文件
│   └── 📁 types/                # TypeScript类型定义
├── 📁 tests/                    # 测试文件
├── 📄 .env.example              # 环境变量示例
├── 📄 .eslintrc.json            # ESLint配置
├── 📄 .gitignore               # Git忽略文件
├── 📄 next.config.js           # Next.js配置
├── 📄 package.json             # 项目依赖
├── 📄 tailwind.config.js       # Tailwind配置
├── 📄 tsconfig.json            # TypeScript配置
└── 📄 README.md                # 项目说明
```

### 📝 关键文件说明

#### Next.js 配置
```javascript
// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    serverActions: true,
    typedRoutes: true,
  },
  
  images: {
    domains: ['cdn.zhilink.com', 'via.placeholder.com'],
    formats: ['image/webp', 'image/avif'],
  },
  
  env: {
    CUSTOM_KEY: process.env.CUSTOM_KEY,
  },
  
  async rewrites() {
    return [
      {
        source: '/api/v1/:path*',
        destination: `${process.env.API_URL}/api/v1/:path*`,
      },
    ];
  },
  
  async headers() {
    return [
      {
        source: '/(.*)',
        headers: [
          {
            key: 'X-Frame-Options',
            value: 'DENY',
          },
          {
            key: 'X-Content-Type-Options',
            value: 'nosniff',
          },
        ],
      },
    ];
  },
  
  webpack: (config, { buildId, dev, isServer, defaultLoaders, nextRuntime, webpack }) => {
    // 自定义 webpack 配置
    if (!isServer) {
      config.resolve.fallback = {
        ...config.resolve.fallback,
        fs: false,
        net: false,
        tls: false,
      };
    }
    
    return config;
  },
};

module.exports = nextConfig;
```

#### TypeScript 配置
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["dom", "dom.iterable", "es6"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"],
      "@/components/*": ["./src/components/*"],
      "@/hooks/*": ["./src/hooks/*"],
      "@/lib/*": ["./src/lib/*"],
      "@/styles/*": ["./src/styles/*"],
      "@/types/*": ["./src/types/*"],
      "@/stores/*": ["./src/stores/*"],
      "@/utils/*": ["./src/lib/utils/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts"
  ],
  "exclude": ["node_modules"]
}
```

---

## 💻 开发工作流

### 🔄 Git 工作流

```bash
# 1. 功能开发流程
git checkout -b feature/user-authentication
git add .
git commit -m "feat(auth): implement user authentication system"
git push origin feature/user-authentication

# 2. 提交信息规范 (Conventional Commits)
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 样式修改
refactor: 代码重构
test: 测试相关
chore: 构建过程或辅助工具的变动

# 3. 分支管理
main        # 主分支，用于生产部署
develop     # 开发分支，用于功能集成
feature/*   # 功能分支
hotfix/*    # 紧急修复分支
release/*   # 发布分支
```

### ⚡ 开发命令详解

```bash
# 开发相关命令
pnpm dev              # 启动开发服务器 (localhost:3000)
pnpm dev:turbo        # 使用 Turbopack 启动 (更快)
pnpm build            # 生产环境构建
pnpm start            # 启动生产服务器
pnpm preview          # 预览生产构建

# 代码质量检查
pnpm lint             # ESLint 检查
pnpm lint:fix         # 自动修复 ESLint 问题
pnpm typecheck        # TypeScript 类型检查
pnpm format:check     # Prettier 格式检查
pnpm format:write     # Prettier 格式化代码

# 测试相关命令
pnpm test             # 运行单元测试
pnpm test:watch       # 监听模式运行测试
pnpm test:coverage    # 生成测试覆盖率报告
pnpm test:e2e         # 运行端到端测试

# 数据库操作
pnpm db:generate      # 生成 Prisma 客户端
pnpm db:push          # 推送 schema 到数据库
pnpm db:migrate       # 运行数据库迁移
pnpm db:studio        # 打开 Prisma Studio
pnpm db:seed          # 填充种子数据

# 组件开发
pnpm storybook        # 启动 Storybook
pnpm build-storybook  # 构建 Storybook

# 分析和调试
pnpm analyze          # 分析构建包大小
pnpm bundle-analyzer  # 可视化包分析
pnpm lighthouse       # 运行 Lighthouse 分析
```

### 🧪 测试策略

```typescript
// 测试配置 - jest.config.js
const config = {
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],
  testPathIgnorePatterns: ['<rootDir>/.next/', '<rootDir>/node_modules/'],
  transform: {
    '^.+\\.(js|jsx|ts|tsx)$': ['babel-jest', { presets: ['next/babel'] }],
  },
  moduleNameMapping: {
    '^@/(.*)$': '<rootDir>/src/$1',
  },
  collectCoverageFrom: [
    'src/**/*.{js,jsx,ts,tsx}',
    '!src/**/*.d.ts',
    '!src/**/*.stories.{js,jsx,ts,tsx}',
  ],
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80,
    },
  },
};

module.exports = config;
```

### 📏 代码规范

#### ESLint 配置
```json
{
  "extends": [
    "next/core-web-vitals",
    "@typescript-eslint/recommended",
    "prettier"
  ],
  "rules": {
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/no-explicit-any": "warn",
    "react-hooks/exhaustive-deps": "warn",
    "prefer-const": "error",
    "no-var": "error"
  },
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "ecmaVersion": 2020,
    "sourceType": "module",
    "ecmaFeatures": {
      "jsx": true
    }
  }
}
```

#### Prettier 配置
```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false,
  "bracketSpacing": true,
  "bracketSameLine": false,
  "arrowParens": "avoid"
}
```

---

## 🧩 组件开发指南

### 📝 组件编写规范

```typescript
// 组件模板示例
// src/components/ui/example-component.tsx

import React from 'react';
import { cn } from '@/lib/utils';
import { cva, type VariantProps } from 'class-variance-authority';

// 1. 样式变体定义
const exampleVariants = cva(
  'base-styles-here',
  {
    variants: {
      variant: {
        default: 'default-styles',
        secondary: 'secondary-styles',
      },
      size: {
        sm: 'small-styles',
        md: 'medium-styles',
        lg: 'large-styles',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'md',
    },
  }
);

// 2. 组件Props接口
interface ExampleComponentProps 
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof exampleVariants> {
  children: React.ReactNode;
  disabled?: boolean;
  loading?: boolean;
}

// 3. 组件实现
const ExampleComponent = React.forwardRef<HTMLDivElement, ExampleComponentProps>(
  ({ className, variant, size, children, disabled, loading, ...props }, ref) => {
    return (
      <div
        ref={ref}
        className={cn(exampleVariants({ variant, size }), className)}
        aria-disabled={disabled}
        {...props}
      >
        {loading ? <LoadingSpinner /> : children}
      </div>
    );
  }
);

ExampleComponent.displayName = 'ExampleComponent';

export { ExampleComponent, exampleVariants };
export type { ExampleComponentProps };
```

### 🎨 样式编写规范

```css
/* Tailwind CSS 自定义样式 */
/* src/styles/components.css */

@layer components {
  /* 基础组件样式 */
  .btn-base {
    @apply inline-flex items-center justify-center;
    @apply rounded-lg font-medium transition-colors;
    @apply focus-visible:outline-none focus-visible:ring-2;
    @apply disabled:pointer-events-none disabled:opacity-50;
  }
  
  /* Cloudsway 设计系统样式 */
  .card-cloudsway {
    @apply bg-cloudsway-glass-bg backdrop-blur-xl;
    @apply border border-cloudsway-glass-border;
    @apply rounded-xl shadow-lg;
  }
  
  /* 6角色颜色样式 */
  .agent-alex { @apply text-[#3b82f6] bg-[#3b82f6]/10; }
  .agent-sarah { @apply text-[#8b5cf6] bg-[#8b5cf6]/10; }
  .agent-mike { @apply text-[#10b981] bg-[#10b981]/10; }
  .agent-emma { @apply text-[#f59e0b] bg-[#f59e0b]/10; }
  .agent-david { @apply text-[#6366f1] bg-[#6366f1]/10; }
  .agent-catherine { @apply text-[#ec4899] bg-[#ec4899]/10; }
}

@layer utilities {
  /* 实用工具类 */
  .text-gradient-primary {
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
}
```

### 🔧 Hooks 开发规范

```typescript
// 自定义Hook示例
// src/hooks/use-example.ts

import { useState, useEffect, useCallback } from 'react';

interface UseExampleOptions {
  initialValue?: string;
  debounceMs?: number;
}

interface UseExampleReturn {
  value: string;
  setValue: (value: string) => void;
  debouncedValue: string;
  isLoading: boolean;
  error: Error | null;
}

export function useExample(options: UseExampleOptions = {}): UseExampleReturn {
  const { initialValue = '', debounceMs = 300 } = options;
  
  const [value, setValue] = useState(initialValue);
  const [debouncedValue, setDebouncedValue] = useState(initialValue);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<Error | null>(null);
  
  // 防抖处理
  useEffect(() => {
    const timer = setTimeout(() => {
      setDebouncedValue(value);
    }, debounceMs);
    
    return () => clearTimeout(timer);
  }, [value, debounceMs]);
  
  // 业务逻辑处理
  const handleSetValue = useCallback((newValue: string) => {
    try {
      setIsLoading(true);
      setError(null);
      setValue(newValue);
      
      // 执行副作用
      // ...
      
    } catch (err) {
      setError(err as Error);
    } finally {
      setIsLoading(false);
    }
  }, []);
  
  return {
    value,
    setValue: handleSetValue,
    debouncedValue,
    isLoading,
    error,
  };
}
```

---

## 🗄️ 数据库开发

### 📊 Prisma Schema 设计

```prisma
// schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 用户表
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  avatar    String?
  role      UserRole @default(BUYER)
  
  // 公司信息
  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?
  
  // 偏好设置
  preferences Json?
  
  // 订阅信息
  subscription UserSubscription?
  
  // 关联关系
  sessions     AnalysisSession[]
  orders       Order[]
  reviews      Review[]
  favorites    UserFavorite[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("users")
}

// 产品表
model Product {
  id          String        @id @default(cuid())
  name        String
  slug        String        @unique
  description String
  type        ProductType
  status      ProductStatus @default(DRAFT)
  
  // 供应商信息
  vendor   Vendor @relation(fields: [vendorId], references: [id])
  vendorId String
  
  // 产品信息
  category String
  tags     String[]
  industry Industry[]
  
  // 媒体资源
  images      String[]
  videos      String[]
  documents   Json?
  
  // 定价信息
  pricing Json
  
  // 技术指标
  metrics Json?
  
  // 评价统计
  rating      Float   @default(0)
  ratingCount Int     @default(0)
  
  // 关联关系
  reviews     Review[]
  favorites   UserFavorite[]
  orderItems  OrderItem[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  publishedAt DateTime?
  
  @@map("products")
}

// 分析会话表
model AnalysisSession {
  id     String            @id @default(cuid())
  title  String
  status AnalysisStatus    @default(INITIALIZING)
  
  // 用户信息
  user   User   @relation(fields: [userId], references: [id])
  userId String
  
  // 会话内容
  input     Json  // 用户输入
  analysis  Json? // 6角色分析结果
  synthesis Json? // 综合结果
  
  // 消息记录
  messages ChatMessage[]
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  completedAt DateTime?
  
  @@map("analysis_sessions")
}

// 枚举定义
enum UserRole {
  BUYER
  VENDOR
  DISTRIBUTOR
}

enum ProductType {
  WORKFORCE
  EXPERT_MODULE
  MARKET_REPORT
}

enum ProductStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum Industry {
  LEGAL
  MEDICAL
  ECOMMERCE
}

enum AnalysisStatus {
  INITIALIZING
  ANALYZING
  COMPLETED
  FAILED
}
```

### 🔧 数据库操作示例

```typescript
// src/lib/database/products.ts
import { prisma } from '@/lib/database/client';
import { Product, ProductFilters } from '@/types';

export class ProductRepository {
  // 获取产品列表
  async findMany(filters: ProductFilters, page = 1, limit = 20) {
    const skip = (page - 1) * limit;
    
    const where = {
      status: 'PUBLISHED',
      ...(filters.type && { type: { in: filters.type } }),
      ...(filters.category && { category: { in: filters.category } }),
      ...(filters.industry && { industry: { hasMany: filters.industry } }),
      ...(filters.search && {
        OR: [
          { name: { contains: filters.search, mode: 'insensitive' } },
          { description: { contains: filters.search, mode: 'insensitive' } },
          { tags: { has: filters.search } },
        ],
      }),
    };
    
    const [products, total] = await Promise.all([
      prisma.product.findMany({
        where,
        include: {
          vendor: true,
          _count: {
            select: {
              reviews: true,
              favorites: true,
            },
          },
        },
        skip,
        take: limit,
        orderBy: this.buildOrderBy(filters.sort, filters.order),
      }),
      prisma.product.count({ where }),
    ]);
    
    return {
      items: products,
      pagination: {
        page,
        pageSize: limit,
        total,
        totalPages: Math.ceil(total / limit),
        hasNext: page * limit < total,
        hasPrevious: page > 1,
      },
    };
  }
  
  // 获取产品详情
  async findById(id: string) {
    return prisma.product.findUnique({
      where: { id },
      include: {
        vendor: true,
        reviews: {
          include: {
            user: {
              select: { name: true, avatar: true },
            },
          },
          orderBy: { createdAt: 'desc' },
          take: 10,
        },
        _count: {
          select: {
            reviews: true,
            favorites: true,
          },
        },
      },
    });
  }
  
  // 搜索产品
  async search(query: string, filters: ProductFilters) {
    return prisma.product.findMany({
      where: {
        status: 'PUBLISHED',
        OR: [
          { name: { contains: query, mode: 'insensitive' } },
          { description: { contains: query, mode: 'insensitive' } },
          { tags: { has: query } },
        ],
        ...(filters.type && { type: { in: filters.type } }),
        ...(filters.category && { category: { in: filters.category } }),
      },
      include: {
        vendor: true,
        _count: {
          select: { reviews: true, favorites: true },
        },
      },
      take: 50,
    });
  }
  
  private buildOrderBy(sort?: string, order?: 'asc' | 'desc') {
    const direction = order || 'desc';
    
    switch (sort) {
      case 'name':
        return { name: direction };
      case 'rating':
        return { rating: direction };
      case 'popularity':
        return { ratingCount: direction };
      case 'newest':
        return { createdAt: direction };
      default:
        return { createdAt: 'desc' };
    }
  }
}

export const productRepository = new ProductRepository();
```

---

## 🚀 部署指南

### 🌐 Vercel 部署 (推荐)

```bash
# 1. 安装 Vercel CLI
npm i -g vercel

# 2. 登录 Vercel
vercel login

# 3. 项目初始化
vercel

# 4. 环境变量配置
vercel env add NEXT_PUBLIC_API_URL
vercel env add DATABASE_URL
vercel env add OPENAI_API_KEY

# 5. 部署到生产环境
vercel --prod
```

### 🐳 Docker 部署

```dockerfile
# Dockerfile
FROM node:18-alpine AS base

# 安装依赖
FROM base AS deps
RUN apk add --no-cache libc6-compat
WORKDIR /app

COPY package.json pnpm-lock.yaml* ./
RUN corepack enable pnpm && pnpm i --frozen-lockfile

# 构建应用
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

ENV NEXT_TELEMETRY_DISABLED 1
RUN corepack enable pnpm && pnpm build

# 生产镜像
FROM base AS runner
WORKDIR /app

ENV NODE_ENV production
ENV NEXT_TELEMETRY_DISABLED 1

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000
ENV PORT 3000

CMD ["node", "server.js"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://postgres:password@db:5432/zhilink
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis
    
  db:
    image: postgres:15
    environment:
      POSTGRES_DB: zhilink
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

### ☁️ AWS 部署

```bash
# 使用 AWS CDK 部署
npm install -g aws-cdk

# 初始化 CDK 项目
cdk init app --language typescript

# 部署到 AWS
cdk deploy
```

---

## 🔍 调试与监控

### 🐛 调试工具配置

```json
// .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Next.js: debug server-side",
      "type": "node",
      "request": "attach",
      "port": 9229,
      "skipFiles": ["<node_internals>/**"]
    },
    {
      "name": "Next.js: debug client-side",
      "type": "chrome",
      "request": "launch",
      "url": "http://localhost:3000"
    },
    {
      "name": "Next.js: debug full stack",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/node_modules/.bin/next",
      "args": ["dev"],
      "console": "integratedTerminal",
      "skipFiles": ["<node_internals>/**"]
    }
  ]
}
```

### 📊 性能监控

```typescript
// src/lib/monitoring/performance.ts
import { NextWebVitalsMetric } from 'next/app';

export function reportWebVitals(metric: NextWebVitalsMetric) {
  const { id, name, label, value } = metric;
  
  // 发送到分析服务
  if (process.env.NODE_ENV === 'production') {
    // Google Analytics
    window.gtag?.('event', name, {
      event_category: label === 'web-vital' ? 'Web Vitals' : 'Next.js custom metric',
      value: Math.round(name === 'CLS' ? value * 1000 : value),
      event_label: id,
      non_interaction: true,
    });
    
    // Vercel Analytics
    window.va?.track(name, { value, label });
    
    // 自定义监控
    fetch('/api/analytics/web-vitals', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ metric }),
    });
  }
  
  // 开发环境日志
  if (process.env.NODE_ENV === 'development') {
    console.log('Web Vital:', { name, value, label });
  }
}
```

### 🚨 错误监控

```typescript
// src/lib/monitoring/error-boundary.tsx
import React from 'react';
import * as Sentry from '@sentry/nextjs';

interface ErrorBoundaryState {
  hasError: boolean;
  error?: Error;
}

export class ErrorBoundary extends React.Component<
  React.PropsWithChildren<{}>,
  ErrorBoundaryState
> {
  constructor(props: React.PropsWithChildren<{}>) {
    super(props);
    this.state = { hasError: false };
  }
  
  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    return { hasError: true, error };
  }
  
  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    // 发送错误到 Sentry
    Sentry.captureException(error, {
      contexts: {
        react: {
          componentStack: errorInfo.componentStack,
        },
      },
    });
    
    // 自定义错误日志
    console.error('Error caught by boundary:', error, errorInfo);
  }
  
  render() {
    if (this.state.hasError) {
      return (
        <div className="min-h-screen flex items-center justify-center">
          <div className="text-center">
            <h2 className="text-2xl font-bold mb-4">出错了</h2>
            <p className="text-gray-600 mb-4">
              应用遇到了一个错误，我们已经记录了这个问题。
            </p>
            <button
              onClick={() => this.setState({ hasError: false })}
              className="btn-primary"
            >
              重试
            </button>
          </div>
        </div>
      );
    }
    
    return this.props.children;
  }
}
```

---

## 📋 开发检查清单

### 🏗️ 项目初始化
- [ ] 环境变量配置完成
- [ ] 数据库连接正常
- [ ] 依赖安装无错误
- [ ] 开发服务器启动成功
- [ ] Git 仓库初始化

### 💻 开发环境配置
- [ ] VS Code 插件安装完成
- [ ] ESLint 配置正确
- [ ] Prettier 格式化正常
- [ ] TypeScript 编译无错误
- [ ] 调试配置可用

### 🧪 代码质量检查
- [ ] 单元测试覆盖率 ≥ 80%
- [ ] E2E 测试关键路径
- [ ] 性能测试通过
- [ ] 安全检查通过
- [ ] 代码审查完成

### 🚀 部署准备
- [ ] 生产环境变量配置
- [ ] 构建流程测试
- [ ] Docker 镜像构建
- [ ] 监控和日志配置
- [ ] 错误追踪设置

### 📊 性能优化
- [ ] Core Web Vitals 达标
- [ ] 包大小优化
- [ ] 图片优化
- [ ] 缓存策略实现
- [ ] CDN 配置

---

## 🆘 常见问题解决

### ❌ 常见错误

#### 1. 模块解析错误
```bash
Error: Cannot resolve module '@/components/ui/button'

# 解决方案：
# 检查 tsconfig.json 中的 paths 配置
# 确保 baseUrl 设置正确
```

#### 2. 样式不生效
```bash
Tailwind CSS 样式没有应用

# 解决方案：
# 检查 tailwind.config.js 的 content 配置
# 确保样式文件正确导入
# 清除 .next 缓存重新构建
```

#### 3. API 连接失败
```bash
Network Error: Cannot connect to API

# 解决方案：
# 检查 .env.local 中的 API_URL 配置
# 确保 API 服务正在运行
# 检查 CORS 配置
```

### 🔧 性能调优

```typescript
// 组件性能优化示例
import { memo, useMemo, useCallback } from 'react';

const OptimizedComponent = memo(({ items, onItemClick }) => {
  // 使用 useMemo 缓存计算结果
  const processedItems = useMemo(() => {
    return items.map(item => ({
      ...item,
      processed: true,
    }));
  }, [items]);
  
  // 使用 useCallback 缓存函数引用
  const handleClick = useCallback((id: string) => {
    onItemClick(id);
  }, [onItemClick]);
  
  return (
    <div>
      {processedItems.map(item => (
        <div key={item.id} onClick={() => handleClick(item.id)}>
          {item.name}
        </div>
      ))}
    </div>
  );
});
```

### 🔐 安全最佳实践

```typescript
// 输入验证和清理
import DOMPurify from 'dompurify';
import { z } from 'zod';

// 使用 Zod 进行输入验证
const userInputSchema = z.object({
  name: z.string().min(1).max(100),
  email: z.string().email(),
  content: z.string().max(1000),
});

// 清理 HTML 内容
const sanitizeHtml = (html: string) => {
  return DOMPurify.sanitize(html, {
    ALLOWED_TAGS: ['p', 'br', 'strong', 'em'],
    ALLOWED_ATTR: [],
  });
};

// API 路由安全示例
export async function POST(request: Request) {
  try {
    const body = await request.json();
    
    // 验证输入
    const validatedData = userInputSchema.parse(body);
    
    // 清理内容
    const cleanContent = sanitizeHtml(validatedData.content);
    
    // 处理业务逻辑
    // ...
    
  } catch (error) {
    if (error instanceof z.ZodError) {
      return Response.json({ error: 'Invalid input' }, { status: 400 });
    }
    
    return Response.json({ error: 'Internal error' }, { status: 500 });
  }
}
```

---

**文档版本**: v3.0.0  
**最后更新**: 2025年8月13日  
**负责团队**: LaunchX前端开发团队
## 执行计划部分
# 07_开发执行计划.md

> **zhilink-v3 Claude Code + MCP 协作开发指南**  
> **AI辅助开发的最佳实践操作手册**  
> **基于6角色系统的智能化开发流程**

---

## 🎯 执行计划概述

### 🤖 AI协作开发理念

基于Claude Code强大的代码生成和MCP工具集成能力，我们采用**人机协作**的智能化开发模式：

```typescript
// AI协作开发架构
interface AIAssistedDevelopment {
  human: {
    role: '产品决策 + 业务逻辑 + 代码审查 + 体验优化';
    tools: 'IDE + 设计工具 + 测试工具';
    focus: '战略决策 + 创意设计 + 质量把控';
  };
  
  ai: {
    role: 'Claude Code + 专业MCP服务';
    capabilities: [
      '代码生成和重构',
      '文档撰写和维护', 
      '测试用例编写',
      '性能优化建议',
      '最佳实践推荐'
    ];
    tools: [
      'ui-designer MCP',    // UI组件设计
      'frontend-developer MCP',  // 前端开发
      'test-writer MCP',    // 测试编写
      'performance-optimizer MCP' // 性能优化
    ];
  };
  
  collaboration: {
    workflow: '敏捷迭代 + 实时反馈 + 持续优化';
    communication: 'Todo列表 + 代码注释 + 文档同步';
    quality: '自动化测试 + 代码审查 + 性能监控';
  };
}
```

### 📋 开发优先级策略

基于参考文档和业务需求，我们采用**MVF (Minimum Viable Feature)** 开发策略：

```mermaid
graph TD
    A[核心价值验证] --> B[用户体验优化]
    B --> C[功能完善扩展]
    C --> D[性能体验提升]
    
    A --> A1[6角色AI咨询核心流程]
    A --> A2[产品展示和搜索基础]
    A --> A3[Cloudsway设计系统]
    
    B --> B1[响应式适配优化]
    B --> B2[交互动效完善]
    B --> B3[错误处理机制]
    
    C --> C1[高级筛选功能]
    C --> C2[用户偏好系统]
    C --> C3[数据分析面板]
    
    D --> D1[性能监控和优化]
    D --> D2[缓存策略完善]
    D --> D3[SEO和可访问性]
```

---

## 📅 8周开发执行计划

### 🚀 Week 1-2: 基础架构与核心设计系统

#### Week 1: 项目搭建与设计系统
```bash
# Claude Code 操作指令
任务目标: 完成项目脚手架和Cloudsway 2.0设计系统实现

具体操作:
1. 创建Next.js 14项目架构
   - 使用claude-frontend-developer MCP
   - 配置TypeScript + Tailwind CSS 4.0
   - 集成shadcn/ui组件库
   - 设置ESLint + Prettier + Husky

2. 实现Cloudsway 2.0设计系统
   - 使用ui-designer MCP
   - 实现深空色彩变量系统
   - 创建6角色专属色彩标识
   - 构建玻璃态效果组件

3. 建立组件库基础
   - 参考组件库规范文档
   - 实现Button/Input/Card等原子组件
   - 创建AgentAvatar分子组件
   - 建立Storybook文档系统

Claude Code提示词:
"基于zhilink-v3文档，使用frontend-developer MCP创建Next.js 14项目。重点实现Cloudsway 2.0设计系统，包括深空主题色彩、6角色专属标识、玻璃态效果。参考02_视觉设计系统.md和05_组件库规范.md完整实现。"
```

#### Week 2: 首页完整实现
```bash
# Claude Code 操作指令
任务目标: 完成首页所有模块，建立品牌形象

具体操作:
1. 实现导览式首页布局
   - 基于03_页面布局方案.md v2.0设计
   - 中心科技动画框(参考zhilink-platform实现)
   - 右侧登录面板(WeChat/TikTok/邮箱注册)
   - 3+1动态身份选择系统

2. 三大产品类型展示
   - AI劳动力(蓝色系)、专家模块(紫色系)、市场报告(绿色系)
   - 色彩区分和视觉自洽设计
   - 产品数量实时统计展示

3. 建立数据mock系统
   - 创建产品数据模型
   - 用户身份和权限模型
   - 分析会话数据结构

Claude Code提示词:
"实现zhilink-v3主页导览设计，重点关注安全性和加载性能。参考03_页面布局方案.md的v2.0设计，实现中心动画框、登录面板、三大产品类型展示。使用ui-designer MCP确保Cloudsway色彩体系一致性。"
```

### 🛒 Week 3-4: AI市场页与智能搜索

#### Week 3: 产品展示与筛选系统
```bash
# Claude Code 操作指令  
任务目标: 构建完整的AI产品市场展示页面

具体操作:
1. 实现产品网格展示
   - 基于现有zhilink-v2/market/page.tsx优化
   - 增强型产品卡片(支持分销功能)
   - 三大产品类型Tab导航
   - 用户身份权限的UI上下文切换

2. 多维筛选系统
   - 产品类型/行业/价格区间筛选
   - 供应商等级和评分筛选
   - 筛选状态持久化
   - 筛选结果实时更新

3. 分销功能集成
   - 分销链接生成组件
   - 佣金计算展示
   - 分享功能卡片集成
   - 身份权限控制

Claude Code提示词:
"基于zhilink-v2市场页代码，实现zhilink-v3增强版市场页。重点实现3+1身份系统的UI切换、分销功能集成、三大产品类型的色彩区分。参考03_页面布局方案.md的产品卡片设计和业务架构文档。"
```

#### Week 4: 智能搜索与推荐
```bash
# Claude Code 操作指令
任务目标: 实现智能搜索和个性化推荐系统

具体操作:
1. 智能搜索功能
   - 实时搜索with防抖机制
   - 搜索建议和自动补全
   - 搜索历史管理
   - 无结果页面优化

2. 推荐算法前端实现
   - 基于用户身份的推荐
   - 基于浏览历史的相关推荐
   - 热门产品推荐
   - 个性化排序展示

3. 性能优化第一轮
   - 虚拟滚动实现
   - 图片懒加载
   - 预加载策略
   - 缓存机制

Claude Code提示词:
"实现智能搜索和推荐系统，使用performance-optimizer MCP进行性能优化。重点关注搜索体验流畅性、推荐准确性、大数据量展示性能。参考06_数据交互设计.md的缓存策略。"
```

### 💬 Week 5-6: 6角色AI协作系统

#### Week 5: 对话界面核心实现  
```bash
# Claude Code 操作指令
任务目标: 实现6角色AI协作的核心对话系统

具体操作:
1. 聊天界面布局
   - 基于zhilink-v2 chat页面优化
   - 消息流组件和状态管理
   - 文件上传和多媒体支持
   - 实时打字效果

2. 6角色可视化系统
   - AgentAvatar组件完善
   - 角色状态指示器
   - 分析进度可视化
   - 角色色彩一致性

3. WebSocket实时通信
   - 分析进度实时更新
   - 角色分析状态同步
   - 断线重连机制
   - 消息队列处理

Claude Code提示词:
"实现6角色AI协作的聊天界面，重点关注实时性和可视化效果。基于现有chat页面代码优化，实现WebSocket通信、角色状态管理、进度可视化。参考05_组件库规范.md的ChatInterface组件。"
```

#### Week 6: 分析结果展示与导出
```bash
# Claude Code 操作指令
任务目标: 完善分析结果展示和报告生成功能

具体操作:
1. 分析结果选项卡
   - 六角色分析结果展示
   - 产品推荐列表组件
   - 风险机会分析视图
   - 行动计划时间线

2. 报告导出功能
   - PDF报告生成
   - 分享链接功能
   - 数据可视化图表
   - 打印友好布局

3. 移动端适配优化
   - 聊天界面移动端体验
   - 角色状态移动端显示
   - 触摸交互优化
   - 键盘适配处理

Claude Code提示词:
"完善分析结果展示和移动端适配，使用ui-designer MCP优化移动端体验。重点实现结果可视化、报告导出、跨设备一致性。参考04_交互动效设计.md的动画效果。"
```

### 📊 Week 7-8: 项目分析页与整体优化

#### Week 7: 项目分析页完整实现
```bash
# Claude Code 操作指令
任务目标: 基于project-page.html实现完整的项目分析功能

具体操作:
1. 项目信息收集表单
   - 结构化表单设计
   - 实时验证和错误处理
   - 表单数据持久化
   - 用户友好的引导流程

2. 分析进度可视化
   - 整体进度条展示
   - 6角色分析进度
   - 实时状态更新
   - 可中断和恢复机制

3. 结果展示选项卡
   - 六角色分析结果网格
   - 产品推荐匹配度展示
   - 风险机会双栏布局
   - 行动计划步骤列表

Claude Code提示词:
"基于project-page.html实现完整的项目分析页，重点关注用户体验流畅性和数据可视化效果。实现表单验证、进度可视化、结果展示。参考frontend-design.md的项目分析页规范。"
```

#### Week 8: 全面测试与发布准备
```bash
# Claude Code 操作指令
任务目标: 完成全流程测试、性能优化和发布准备

具体操作:
1. 全流程功能测试
   - 使用test-writer MCP生成测试用例
   - 端到端流程验证
   - 兼容性测试
   - 无障碍访问测试

2. 性能优化最终轮
   - 使用performance-optimizer MCP
   - 代码分割优化
   - 资源压缩和CDN
   - 性能监控集成

3. 发布部署准备
   - 环境变量配置
   - Docker容器化
   - CI/CD流程配置
   - 监控和日志系统

Claude Code提示词:
"完成项目最终测试和优化，使用test-writer-fixer MCP确保测试覆盖率，performance-benchmarker MCP进行性能验证。准备生产环境部署，确保所有质量指标达标。"
```

---

## 🤖 MCP服务协作指南

### 🎨 UI设计协作流程

#### ui-designer MCP 使用策略
```bash
# 使用场景1: 组件设计优化
提示词模板:
"使用ui-designer MCP优化ProductCard组件设计，要求：
1. 遵循Cloudsway 2.0设计系统
2. 支持三大产品类型色彩区分  
3. 集成分销功能按钮
4. 确保移动端适配良好
5. 参考zhilink-v2现有实现优化"

# 使用场景2: 页面布局设计
提示词模板:
"使用ui-designer MCP设计市场页面布局，要求：
1. 实现3+1身份系统的UI上下文切换
2. 产品网格和筛选侧栏布局
3. 响应式断点适配
4. 深空主题色彩应用
5. 基于03_页面布局方案.md规范"

# 使用场景3: 交互状态设计  
提示词模板:
"使用ui-designer MCP设计6角色状态指示器，要求：
1. 6种角色色彩标识
2. 思考中/分析中/完成状态
3. 动画过渡效果
4. 置信度进度显示
5. 移动端友好显示"
```

#### visual-storyteller MCP 集成
```bash
# 数据可视化设计
提示词模板:
"使用visual-storyteller MCP创建分析结果可视化，要求：
1. 6角色分析结果雷达图
2. 产品推荐匹配度条形图  
3. 风险机会象限图
4. 行动计划时间线图
5. 遵循Cloudsway色彩体系"

# 用户引导设计
提示词模板:
"使用visual-storyteller MCP设计用户引导流程，要求：
1. 首次访问引导动画
2. 6角色AI协作介绍
3. 产品类型说明图解
4. 身份系统切换说明
5. 视觉连贯性保证"
```

### 💻 前端开发协作流程

#### frontend-developer MCP 核心用法
```bash
# 核心功能开发
提示词模板:
"使用frontend-developer MCP实现智能搜索功能，要求：
1. TypeScript严格模式开发
2. React 18 + Next.js 14最佳实践
3. Zustand状态管理集成
4. TanStack Query数据获取
5. 参考06_数据交互设计.md架构"

# 组件库开发
提示词模板:
"使用frontend-developer MCP创建AgentAvatar组件，要求：
1. 基于05_组件库规范.md标准
2. 支持6种角色和4种状态
3. 响应式尺寸适配
4. 无障碍访问支持
5. Storybook文档集成"

# 性能优化
提示词模板:
"使用frontend-developer MCP优化产品列表性能，要求：
1. 虚拟滚动实现
2. 图片懒加载策略
3. 搜索防抖处理
4. 状态更新优化
5. 内存泄漏预防"
```

#### mobile-app-builder MCP 移动端优化
```bash
# 移动端适配
提示词模板:
"使用mobile-app-builder MCP优化移动端体验，要求：
1. 触摸友好的交互设计
2. 屏幕尺寸自适应
3. 手势操作支持
4. 性能优化策略
5. 原生感体验实现"

# PWA功能
提示词模板:
"使用mobile-app-builder MCP添加PWA功能，要求：
1. Service Worker缓存策略
2. 离线模式支持
3. 推送通知集成
4. 安装引导流程
5. 性能指标监控"
```

### 🧪 测试与质量保证

#### test-writer-fixer MCP 测试策略
```bash
# 组件测试
提示词模板:
"使用test-writer-fixer MCP为ProductCard组件编写测试，要求：
1. 单元测试覆盖率90%+
2. 集成测试关键流程
3. 可访问性测试
4. 性能基准测试
5. 视觉回归测试"

# 端到端测试
提示词模板:
"使用test-writer-fixer MCP创建6角色分析端到端测试，要求：
1. 完整用户流程覆盖
2. 错误边界测试
3. 性能阈值验证
4. 跨浏览器兼容性
5. 移动端测试场景"
```

#### performance-benchmarker MCP 性能监控
```bash
# 性能基准测试
提示词模板:
"使用performance-benchmarker MCP进行性能测试，要求：
1. Core Web Vitals指标
2. 首页加载性能测试
3. 搜索响应时间测试
4. 内存使用情况分析
5. 网络条件模拟测试"

# 持续性能监控
提示词模板:
"使用performance-benchmarker MCP建立性能监控，要求：
1. 实时性能指标收集
2. 性能阈值告警机制
3. 性能趋势分析
4. 用户体验指标追踪
5. 优化建议自动生成"
```

---

## 📊 开发进度管理

### 🎯 Todo管理最佳实践

#### Claude Code Todo使用规范
```typescript
// Todo管理策略
interface TodoManagement {
  创建原则: {
    granularity: '每个todo应该是2-4小时可完成的具体任务';
    clarity: '使用明确的动词和具体的交付物描述';
    priority: '标注优先级和依赖关系';
    context: '包含必要的上下文信息和参考文档';
  };
  
  状态管理: {
    pending: '任务已创建，等待开始';
    in_progress: '正在进行中，同时只能有1-2个';
    completed: '已完成，立即标记完成状态';
    blocked: '遇到阻塞，需要明确阻塞原因';
  };
  
  更新频率: {
    实时更新: '开始任务时立即标记in_progress';
    及时完成: '完成任务后立即标记completed';
    批量规划: '每个session开始时批量创建todos';
    周期回顾: '每日回顾进度和调整计划';
  };
}

// Todo示例模板
const TODO_TEMPLATES = {
  component_development: "实现{ComponentName}组件 - 基于{ReferenceDoc}规范，包含{SpecificFeatures}功能",
  page_implementation: "完成{PageName}页面布局 - 参考{DesignDoc}，实现{KeyFeatures}核心功能",
  integration_task: "集成{ServiceName}服务 - 基于{APIDoc}文档，实现{Functionality}功能",
  optimization_task: "优化{FeatureName}性能 - 目标{PerformanceMetric}，使用{OptimizationStrategy}策略",
  testing_task: "编写{ComponentName}测试 - 覆盖{TestScenarios}场景，确保{QualityStandard}质量标准"
};
```

#### 每日开发流程
```bash
# 晨间规划 (9:00-9:30)
1. 回顾昨日完成的todos
2. 分析当日优先级任务
3. 创建具体的todo列表
4. 确认依赖和阻塞因素

Claude Code提示词:
"基于zhilink-v3开发计划，为今日创建详细的todo列表。重点关注{当日重点模块}开发，参考{相关文档}。每个todo应该具体明确，2-4小时可完成。"

# 开发执行 (9:30-17:30)  
1. 选择highest priority todo
2. 标记为in_progress状态
3. 使用相应MCP工具辅助开发
4. 完成后立即标记completed
5. 创建follow-up todos if needed

# 晚间回顾 (17:30-18:00)
1. 回顾当日完成情况
2. 识别未完成任务的阻塞原因
3. 调整明日计划和优先级
4. 更新项目整体进度
```

### 📈 质量控制检查点

#### 每周质量审查
```bash
# Week 1 检查点: 基础架构
质量标准:
- [ ] 项目脚手架完整性
- [ ] Cloudsway设计系统一致性
- [ ] 组件库基础功能完整
- [ ] TypeScript类型定义完善
- [ ] 响应式适配基础功能

Claude Code检查提示词:
"使用test-writer-fixer MCP检查Week 1交付质量，重点验证设计系统一致性、组件库完整性、代码质量标准。参考验收标准文档进行全面检查。"

# Week 2 检查点: 首页完整性
质量标准:
- [ ] 导览式首页布局正确
- [ ] 登录注册流程完整
- [ ] 身份系统切换功能
- [ ] 三大产品类型展示
- [ ] 移动端适配完善

# Week 3-4 检查点: 市场页功能
质量标准:
- [ ] 产品展示网格完整
- [ ] 搜索筛选功能正确
- [ ] 分销功能集成完善
- [ ] 性能指标达标
- [ ] 用户体验流畅

# Week 5-6 检查点: AI协作系统
质量标准:
- [ ] 6角色可视化完整
- [ ] 实时通信稳定
- [ ] 分析结果展示正确
- [ ] 移动端体验优化
- [ ] 错误处理完善

# Week 7-8 检查点: 整体质量
质量标准:
- [ ] 全流程功能完整
- [ ] 性能指标达标
- [ ] 测试覆盖率满足要求
- [ ] 跨浏览器兼容性
- [ ] 生产环境就绪
```

---

## 🚀 技术实施细节

### 🔧 开发环境配置

#### 必需工具和配置
```bash
# 开发环境清单
开发工具:
├── VS Code + Claude Code插件
├── Node.js 18+ + pnpm包管理器
├── Git + GitHub Desktop (可选)
└── Chrome DevTools + React DevTools

MCP服务配置:
├── ui-designer MCP - UI组件设计
├── frontend-developer MCP - 前端开发
├── test-writer-fixer MCP - 测试编写
├── performance-benchmarker MCP - 性能测试
└── mobile-app-builder MCP - 移动端优化

项目依赖:
├── Next.js 14 + React 18 + TypeScript
├── Tailwind CSS 4.0 + shadcn/ui
├── Zustand + TanStack Query
├── Framer Motion + Lucide React
└── Testing Library + Vitest
```

#### 代码质量工具链
```json
{
  "scripts": {
    "dev": "next dev -p 1300",
    "build": "next build",
    "check": "pnpm lint && pnpm typecheck",
    "lint": "eslint . --ext .ts,.tsx --report-unused-disable-directives --max-warnings 0",
    "lint:fix": "eslint . --ext .ts,.tsx --fix",
    "typecheck": "tsc --noEmit",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage"
  },
  "husky": {
    "pre-commit": "pnpm check && pnpm test",
    "pre-push": "pnpm build"
  }
}
```

### 📋 关键实施原则

#### 1. 组件优先开发
```typescript
// 开发顺序: 原子 → 分子 → 有机体 → 模板 → 页面
const DEVELOPMENT_ORDER = {
  week1: ['Button', 'Input', 'Badge', 'Card'],
  week2: ['AgentAvatar', 'ProductCard', 'SearchBox'],
  week3: ['ProductGrid', 'FilterSidebar', 'ProductTypeNavigation'],
  week4: ['ChatInterface', 'AnalysisProgress', 'RecommendationPanel'],
  week5: ['MarketLayout', 'ChatLayout', 'DashboardLayout'],
  week6: ['HomePage', 'MarketPage', 'ChatPage'],
  week7: ['ProjectAnalysisPage', 'UserProfilePage'],
  week8: ['ErrorPages', 'LoadingStates', 'EmptyStates']
};
```

#### 2. 数据驱动开发
```typescript
// Mock数据优先，真实API后续集成
const MOCK_DATA_STRATEGY = {
  week1: '静态JSON数据文件',
  week2: 'MSW Mock Service Worker',
  week3: '动态数据生成器',
  week4: 'WebSocket模拟服务',
  week5: '真实API集成测试',
  week6: '数据验证和错误处理',
  week7: '性能优化和缓存',
  week8: '生产环境配置'
};
```

#### 3. 渐进式增强
```typescript
// 功能实现优先级
const PROGRESSIVE_ENHANCEMENT = {
  core: '核心功能先实现，确保基本可用',
  enhanced: '增强功能后添加，提升用户体验', 
  advanced: '高级功能最后实现，差异化体验',
  
  example: {
    search: {
      core: '基础文本搜索',
      enhanced: '实时搜索建议',
      advanced: 'AI智能推荐'
    },
    
    productCard: {
      core: '基础信息展示',
      enhanced: '交互动效和状态',
      advanced: '个性化和预测'
    }
  }
};
```

---

## ✅ 交付标准与验收

### 🎯 每周交付要求

#### 代码质量标准
```typescript
interface DeliveryStandards {
  codeQuality: {
    typescript: '100% TypeScript覆盖，严格模式';
    eslint: '0 errors, 0 warnings';
    testing: '80%+ 测试覆盖率';
    documentation: '所有公共API文档化';
  };
  
  performance: {
    lighthouse: 'Performance Score > 90';
    coreWebVitals: 'LCP < 2.5s, FID < 100ms, CLS < 0.1';
    bundleSize: '初始包大小 < 1MB';
    loadTime: '首页加载时间 < 3s';
  };
  
  userExperience: {
    responsive: '所有断点完美适配';
    accessibility: 'WCAG 2.1 AA级合规';
    crossBrowser: '主流浏览器兼容';
    errorHandling: '优雅的错误处理';
  };
  
  business: {
    functionality: '业务功能完整正确';
    userFlow: '用户流程顺畅';
    dataIntegrity: '数据一致性保证';
    security: '基础安全措施';
  };
}
```

#### 验收检查清单
```bash
# 每周验收流程
1. 功能验收 (30分钟)
   - 使用test-writer-fixer MCP运行全套测试
   - 手动验证核心用户流程
   - 检查移动端和桌面端体验
   - 验证错误边界和异常处理

2. 性能验收 (20分钟)
   - 使用performance-benchmarker MCP性能测试
   - Chrome DevTools Lighthouse分析
   - 网络条件模拟测试
   - 内存使用情况检查

3. 质量验收 (20分钟)
   - ESLint和TypeScript检查
   - 代码审查和最佳实践
   - 设计系统一致性检查
   - 文档完整性验证

4. 业务验收 (10分钟)
   - 业务逻辑正确性验证
   - 用户体验流程检查
   - 数据展示准确性
   - 品牌一致性确认

Claude Code验收提示词:
"使用相关MCP工具对本周交付进行全面验收检查，重点关注{本周重点功能}的质量和性能。生成详细的验收报告，包括通过项目、需要改进项目和下周重点。"
```

---

## 🎓 最佳实践总结

### 💡 Claude Code使用技巧

#### 高效提示词策略
```bash
# 高质量提示词模板
结构化提示词:
"[任务类型] + [具体要求] + [技术约束] + [参考文档] + [质量标准]"

示例:
"使用frontend-developer MCP实现ProductCard组件，要求支持三大产品类型色彩区分和分销功能，基于React 18+TypeScript开发，参考05_组件库规范.md，确保WCAG 2.1 AA级无障碍访问。"

上下文管理:
- 明确引用相关文档和代码文件
- 保持会话连续性和上下文一致性
- 及时更新todo状态和进度信息
- 记录重要的决策和变更原因
```

#### 协作效率优化
```typescript
// 高效协作模式
const COLLABORATION_PATTERNS = {
  一次性批量任务: {
    适用: '创建多个相似组件、批量测试编写',
    策略: '在单个会话中完成相关任务，保持上下文连续性'
  },
  
  迭代优化任务: {
    适用: '组件优化、性能提升、体验改进',
    策略: '小步快跑，频繁反馈，持续优化'
  },
  
  复杂功能实现: {
    适用: '6角色系统、智能搜索、数据可视化',
    策略: '分解为子任务，逐步实现，定期集成'
  },
  
  质量保证任务: {
    适用: '测试编写、性能优化、安全检查',
    策略: '使用专业MCP工具，自动化检查，持续改进'
  }
};
```

### 📈 项目成功指标

#### 开发效率指标
```typescript
interface SuccessMetrics {
  development: {
    velocity: '每周完成story points > 40';
    quality: '缺陷率 < 5%，返工率 < 10%';
    automation: '自动化测试覆盖率 > 80%';
    documentation: '文档完整性 > 90%';
  };
  
  teamCollaboration: {
    aiAssistance: 'AI辅助开发效率提升 > 3x';
    codeReview: '代码审查通过率 > 95%';
    knowledgeSharing: '最佳实践文档化率 > 90%';
    problemSolving: '阻塞问题解决时间 < 4小时';
  };
  
  userExperience: {
    performance: 'Core Web Vitals全绿';
    accessibility: 'WCAG 2.1 AA级 100%合规';
    crossPlatform: '主流设备和浏览器100%兼容';
    userSatisfaction: '用户满意度 > 4.5/5.0';
  };
  
  business: {
    featureCompleteness: '核心功能完整实现';
    timeline: '按时交付率 > 95%';
    scalability: '系统可扩展性满足需求';
    maintainability: '代码可维护性评分 > 85';
  };
}
```

#### 风险控制措施
```bash
# 常见风险和应对策略
技术风险:
├── 新技术学习曲线 → 提前技术验证，渐进式采用
├── 性能问题 → 早期性能测试，持续监控优化  
├── 兼容性问题 → 自动化跨浏览器测试
└── 安全漏洞 → 代码安全审查，依赖漏洞扫描

进度风险:
├── 需求变更 → 敏捷开发，快速响应调整
├── 技术阻塞 → 预留缓冲时间，备选方案
├── 资源不足 → 优先级管理，核心功能优先
└── 质量问题 → 测试驱动开发，持续集成

协作风险:
├── 沟通误解 → 详细文档，定期确认对齐
├── 依赖阻塞 → 依赖管理，并行开发策略
├── 知识孤岛 → 知识分享，文档化最佳实践
└── 工具故障 → 备用工具链，本地开发环境
```

---

**文档版本**: 1.0  
**最后更新**: 2025年8月13日  
**适用项目**: zhilink-v3 智链平台  
**维护团队**: 开发团队 + AI协作系统

> 💡 **重要提醒**: 这份执行计划文档是动态文档，应该根据实际开发进度和遇到的问题进行持续更新和优化。Claude Code和MCP工具的使用应该基于具体任务需求灵活调整，以实现最佳的开发效率和代码质量。

<function_calls>
<invoke name="TodoWrite">
<parameter name="todos">[{"content": "基于参考文档和架构创建操作计划文档", "status": "completed", "id": "27"}]